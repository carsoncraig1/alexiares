<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alexiares Console</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .blocks-container {
            display: flex;
            justify-content: space-between;
            width: 80%;
            max-width: 800px;
            margin-bottom: 20px;
        }
        .block {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            width: 48%;
            max-height: 150px;
            overflow-y: auto;
        }
        .console-container {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            width: 80%;
            max-width: 800px;
            overflow-y: auto;
            max-height: 60%;
        }
        .console-header {
            font-size: 1.5em;
            color: #00ffcc;
            text-align: center;
            margin-bottom: 10px;
        }
        .console-log {
            background-color: #000000;
            padding: 10px;
            border-radius: 5px;
            color: #ffffff; /* Text color set to white */
            white-space: pre-wrap;
            word-wrap: break-word;
            height: 100%;
            overflow-y: auto;
        }
        .error {
            color: #ff4d4d; /* Red color for error messages */
        }
        .info {
            color: #00ffcc; /* Light cyan color for info messages */
        }
    </style>
</head>
<body>
    <div class="blocks-container">
        <div class="block" id="servedTrojanBlock">
            <h3>Served Trojans:</h3>
            <ul id="servedTrojanList"></ul>
        </div>
        <div class="block" id="cvrLoggedBlock">
            <h3>CVR's Logged: <span id="cvrCount">0</span></h3>
            <ul id="cvrList"></ul>
        </div>
    </div>
    <div class="console-container">
        <div class="console-header">Console Log</div>
        <div id="console-log" class="console-log"></div>
    </div>
    <script>
        const socket = new WebSocket('wss://' + window.location.host);
        const consoleLog = document.getElementById('console-log');
        const servedTrojanList = document.getElementById('servedTrojanList');
        const cvrCountElement = document.getElementById('cvrCount');
        const cvrList = document.getElementById('cvrList');

        let servedTrojanCounts = {};
        let cvrCount = 0;

        socket.onmessage = function(event) {
            const message = event.data;
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            consoleLog.appendChild(messageElement);
            consoleLog.scrollTop = consoleLog.scrollHeight;

            if (message.startsWith('Served')) {
                const offerMatch = message.match(/Served (\w+) Trojan/);
                const s1Match = message.match(/\(([^)]+)\)$/);
                if (offerMatch && s1Match) {
                    const offer = offerMatch[1];
                    const s1 = s1Match[1];
                    const key = `${s1} (${offer})`;
                    if (!servedTrojanCounts[key]) {
                        servedTrojanCounts[key] = 0;
                        const listItem = document.createElement('li');
                        listItem.id = `trojan-${key}`;
                        listItem.textContent = `${key}: ${servedTrojanCounts[key]}`;
                        servedTrojanList.appendChild(listItem);
                    }
                    servedTrojanCounts[key]++;
                    document.getElementById(`trojan-${key}`).textContent = `${key}: ${servedTrojanCounts[key]}`;
                }
            }

            if (message.startsWith('CVR Received:')) {
                cvrCount++;
                cvrCountElement.textContent = cvrCount;
                const priceMatch = message.match(/price:([\d.]+)/);
                if (priceMatch) {
                    const price = parseFloat(priceMatch[1]);
                    const listItem = document.createElement('li');
                    listItem.textContent = `Price: ${price}`;
                    cvrList.appendChild(listItem);
                }
            }
        };

        // Ensure the console log starts at the bottom on page load
        window.onload = () => {
            consoleLog.scrollTop = consoleLog.scrollHeight;
        };
    </script>
</body>
</html>
